<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa Interactivo TV Mundial</title>
  <link href="https://cdn.jsdelivr.net/npm/video.js@8.9.0/dist/video-js.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
    }
    #map {
      background-color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70vh;
    }
    svg path {
      fill: #444;
      stroke: #ccc;
      cursor: pointer;
      transition: fill 0.3s;
    }
    svg path:hover {
      fill: #0080ff;
    }
    #sidebar {
      padding: 1em;
    }
    .channel {
      background: #222;
      padding: 5px 10px;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
    }
    .channel:hover {
      background: #444;
    }
    #playerModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #playerModal.active {
      display: flex;
    }
    #closePlayer {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 2rem;
      cursor: pointer;
      color: white;
    }
  </style>
</head>
<body>

<div id="map">
  <svg viewBox="0 0 800 400" width="800" height="400">
    <path id="us" d="M150 150 L180 150 L180 180 L150 180 Z" title="Estados Unidos" />
    <path id="mx" d="M150 190 L180 190 L180 220 L150 220 Z" title="México" />
    <path id="ca" d="M150 110 L180 110 L180 140 L150 140 Z" title="Canadá" />
    <path id="es" d="M600 180 L630 180 L630 210 L600 210 Z" title="España" />
    <path id="ar" d="M300 350 L330 350 L330 380 L300 380 Z" title="Argentina" />
  </svg>
</div>

<div id="sidebar">
  <h2 id="countryName">Selecciona un país</h2>
  <div id="channels"></div>
</div>

<div id="playerModal">
  <div id="closePlayer">&times;</div>
  <video-js id="tv" class="video-js vjs-default-skin" controls preload="auto" width="720" height="405">
    <source src="" type="application/x-mpegURL">
    Tu navegador no soporta video.
  </video-js>
</div>

<script src="https://cdn.jsdelivr.net/npm/video.js@8.9.0/dist/video.min.js"></script>
<script>
  const player = videojs('tv');
  const playerModal = document.getElementById('playerModal');
  const closePlayer = document.getElementById('closePlayer');

  const countryMap = {
    us: 'Estados Unidos',
    mx: 'México',
    ca: 'Canadá',
    es: 'España',
    ar: 'Argentina'
  };

  document.querySelectorAll('svg path').forEach(path => {
    path.addEventListener('click', async () => {
      const code = path.id;
      const name = countryMap[code];
      document.getElementById('countryName').textContent = `Canales de ${name}`;
      const container = document.getElementById('channels');
      container.innerHTML = '<em>Cargando canales...</em>';

      try {
        const res = await fetch(`https://iptv-org.github.io/iptv/countries/${code}.m3u`);
        const text = await res.text();
        const channels = parseM3U(text);
        container.innerHTML = '';
        channels.forEach(ch => {
          const div = document.createElement('div');
          div.className = 'channel';
          div.textContent = ch.name;
          div.onclick = () => {
            player.src({ type: 'application/x-mpegURL', src: ch.url });
            player.play();
            playerModal.classList.add('active');
          };
          container.appendChild(div);
        });
      } catch (err) {
        container.innerHTML = '<em>Error al cargar canales.</em>';
      }
    });
  });

  closePlayer.onclick = () => {
    player.pause();
    playerModal.classList.remove('active');
  };

  function parseM3U(text) {
    const lines = text.split('\n');
    const result = [];
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith('#EXTINF')) {
        const name = lines[i].split(',')[1] || 'Canal sin nombre';
        const url = lines[i + 1];
        result.push({ name, url });
        i++;
      }
    }
    return result;
  }
</script>

</body>
</html>
